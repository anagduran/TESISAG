html(lang="en")
    head
        meta(charset="UTF-8")
        meta(name="viewport", content="width=device-width, initial-scale=1.0")
        meta(http-equiv="X-UA-Compatible", content="ie=edge")
        link(rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous")
        link(rel="stylesheet", type= "text/css", href="../public/css/style.css")
        link(rel="stylesheet" href="../public/css/bootstrap.css")
        link(rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.18/r-2.2.2/datatables.min.css")       
        
        
        script(type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js") 
        script(type="text/javascript" src='../public/js/bootstrap.js')
        script(type="text/javascript" src='../public/js/bootstrap.min.js')
        
        title  Preguntas
    include ../menuLateral.jade

    div(class='col-md-3 offset-2 row-style')
        h2(class='h1All') Preguntas
    
    div(class='estilo-divtable col-9 offset-2 table-responsive' style="")  
         table(id='tablaUno' class='tableAll table table-striped table-sm table-bordered')       
            thead
                tr.head
                    th(class='thead-light') #
                    th(class='thAll') Pregunta 
                    th(class='thAll') Nivel
                    th(class='thAll') Categoria
                    th(class='thAll') Acciones
        
            tbody(class='tbody-style')
     
                -var i= -1
       
      
        
                each pregunta in preguntas 
                    - ++i   
                    tr(class=(i % 2 == 0) ? 'odd' : 'even')  
                        td(id='tdUno') #{i}
                        td #{pregunta.question} 
                        td #{pregunta.level}
                        td
                            -var j= 0
                            - each categoria in pregunta.category                   
                                -var categoryChange2= JSON.parse(JSON.stringify(pregunta.category))[j]
                                - ++j
                                p #{categoryChange2.name},
                    
                        td 
                            a(href='/question/#{pregunta._id}') 
                                i(id='icon-see' class='fa fa-eye')
                            a(href='/question/edit/#{pregunta._id}') 
                                i(id='icon-edit' class='fas fa-pencil-alt')   
                            button(type='button' id='button1' class='fas fa-trash-alt' data-toggle="modal" data-target="#myModal2" value= pregunta._id onclick='obtenervalor(`#{pregunta._id}`);')                                                     
                            


    div(class="modal fade" id="myModal2" tabindex="-1" role="dialog")
        div(class="modal-dialog" role='document')
            div(class="modal-content")
                div(class='modal-header')
                    h5 Eliminar Pregunta   
                    input(type='text' id='lista' style="visibility:hidden")                                        
                div(class="modal-body")
                    Â¿Estas seguro que desea eliminar este registro?
                div(class="modal-footer")
                    button(type="button" class="btn btn-default" id="closeModal" data-dismiss='modal') Close
                    form(action="" class= "link" method="POST" id='formEliminar')
                    a(class="btn btn-success" href='#' name='POST' onclick='' id='eliminar') Aceptar
                        
    div(class='row')
        div(class='col-sm-4 offset-2') 
            a(href='/question/create' class='btn btn-outline-success' role='button') Nueva Pregunta      
                   

            
    
    script(type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.18/r-2.2.2/datatables.min.js")  
    

script(type="text/javascript").

    $(document).ready(function() {
            $('#tablaUno').DataTable();
    } );


    function obtenervalor(id) {
        $('#lista').val(id);       
    }

    function enviar(){       
        var id = document.getElementById('lista').value;            
        var action = '/question/delete/' 
        var action2 = '?_method=DELETE'
        var total = action.concat(id,action2);      
        
         $.ajax({      
                url: total,
                type: 'DELETE',
                statusCode: {
                    200: function () {
                        alert('ALOOO');
                        console.log("200 - Success");
                    }
                },
            });

        document.getElementById("formEliminar").action = total;
             
       // document.getElementById("formEliminar").submit();
          
    }

    $('#eliminar').click(function(){
        var id = document.getElementById('lista').value;            
        var action = '/question/delete/' 
        var action2 = '?_method=DELETE'
        var total = action.concat(id,action2);   
        console.log(total);
       // document.getElementById("formEliminar").action = total;  
        
        $.ajax({      
                url: total,
                type: 'DELETE',
                statusCode: {
                    200: function () {
                        alert('eliminado exitosamente desde ajax');
                        console.log("200 - Success");
                    },
                    404: function() {
                        console.log('400 error desde ajax');
                    }
                },
            });
        //document.getElementById("formEliminar").submit();
    });

    function validarStatus(url) {    
        var xhr = new XMLHttpRequest();
        xhr.open('DELETE', url, false);
        xhr.send(null);
        console.log('UNSENT', xhr.status);
       /* if(xhr.status==200){
            $('#mensajeExito').append(' Categoria eliminada existosamente')
            $('#mensajeExito').css('visibility', 'visible')
        }*/  
           
    };

    
    function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }


     